{% extends 'dashboard_base.html' %}
{% block dashboard_content %}
<div class="service-form-wrapper">
    
    <!-- Header -->
    <div class="form-header">
        <div>
        <h2 style="color: #fff; font-family: 'Syne'; margin: 0; font-size: 32px;">{{ title }}</h2>
            <p style="color: rgba(255,255,255,0.6); margin-top: 5px;">Define technical capabilities and stack.</p>
        </div>
        <div class="form-mode-toggle">
            <button class="mode-btn active" type="button" onclick="setFormMode('simple')">Simple</button>
            <button class="mode-btn" type="button" onclick="setFormMode('advanced')">Advanced</button>
        </div>
    </div>

    <!-- Form Wizard Progress -->
    <div class="wizard-progress" id="wizard-progress">
        <div class="wizard-step active" data-step="1">
            <div class="step-number">1</div>
            <span>Basic Info</span>
        </div>
        <div class="wizard-step" data-step="2">
            <div class="step-number">2</div>
            <span>Description</span>
        </div>
        <div class="wizard-step" data-step="3">
            <div class="step-number">3</div>
            <span>Tags</span>
        </div>
        <div class="wizard-step" data-step="4">
            <div class="step-number">4</div>
            <span>Review</span>
        </div>
    </div>

    <div class="form-container">
        <!-- Form Panel -->
        <div class="form-panel">
            <div class="glass-card fade-in-up">
        
        <!-- ERROR DISPLAY -->
        {% if form.errors or formset.errors %}
                <div class="error-display">
            <strong><i class="bi bi-exclamation-triangle-fill"></i> Please correct the errors below:</strong>
            {{ form.non_field_errors }}
                    <ul>
                {% for field in form %}
                    {% for error in field.errors %}<li>{{ field.label }}: {{ error }}</li>{% endfor %}
                {% endfor %}
                {% for form in formset %}
                    {% for field in form %}
                        {% for error in field.errors %}<li>Tag Error ({{ field.label }}): {{ error }}</li>{% endfor %}
                    {% endfor %}
                {% endfor %}
            </ul>
        </div>
        {% endif %}

                <form method="POST" enctype="multipart/form-data" id="service-form">
            {% csrf_token %}
            
                    <!-- Step 1: Basic Info -->
                    <div class="form-step active" data-step="1">
                        <h3 class="step-title">Basic Information</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    Category <span class="required">*</span>
                                    <span class="help-icon" title="Select the service category">‚ÑπÔ∏è</span>
                                </label>
                    {{ form.category }}
                                <small class="field-hint">Choose the category this service belongs to</small>
                </div>
                            <div class="form-group">
                                <label>
                                    Service Title <span class="required">*</span>
                                    <span class="char-counter"><span id="title-count">0</span>/200</span>
                                </label>
                    {{ form.title }}
                                <small class="field-hint">e.g., Django Backend Architecture</small>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-next" onclick="nextStep()">Next: Description <i class="bi bi-arrow-right"></i></button>
                </div>
            </div>

                    <!-- Step 2: Description -->
                    <div class="form-step" data-step="2">
                        <h3 class="step-title">Description & Image</h3>
                        
                        <div class="form-group">
                            <label>
                                Description <span class="required">*</span>
                                <span class="char-counter"><span id="desc-count">0</span> words</span>
                            </label>
                {{ form.description }}
                            <small class="field-hint">Describe what this service offers. Minimum 20 words recommended.</small>
                            <div class="word-count-status" id="word-count-status"></div>
            </div>

                        <!-- Enhanced Image Upload -->
                        <div class="form-group">
                            <label>
                                Cover Image <span class="required">*</span>
                            </label>
                            <div class="upload-zone-enhanced" id="upload-zone" onclick="document.getElementById('id_image').click()">
                                <div class="upload-preview" id="image-preview">
                                    <i class="bi bi-image" style="font-size: 48px; color: #00d2ff; margin-bottom: 15px;"></i>
                                    <p id="file-label" style="margin: 0; color: rgba(255,255,255,0.7);">Click to upload or drag & drop</p>
                                    <p id="file-name" style="margin: 10px 0 0 0; color: #00d2ff; font-weight: bold; font-size: 14px;"></p>
                                    <small style="color: rgba(255,255,255,0.4);">PNG, JPG up to 5MB</small>
                                </div>
                <div style="display: none;">
                    {{ form.image }}
                </div>
            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-prev" onclick="prevStep()"><i class="bi bi-arrow-left"></i> Previous</button>
                            <button type="button" class="btn-next" onclick="nextStep()">Next: Tags <i class="bi bi-arrow-right"></i></button>
                        </div>
                    </div>

                    <!-- Step 3: Tags -->
                    <div class="form-step" data-step="3">
                        <h3 class="step-title">Tech Stack Tags</h3>
                        
                        <!-- Smart Tag Suggestions -->
                        <div class="tag-suggestions-panel">
                            <h4>Quick Add Popular Tags</h4>
                            <div class="tag-suggestions" id="tag-suggestions">
                                <button type="button" class="suggestion-tag" data-tag="Python" data-icon="bi bi-code-square"><i class="bi bi-code-square"></i> Python</button>
                                <button type="button" class="suggestion-tag" data-tag="Django" data-icon="bi bi-code-slash"><i class="bi bi-code-slash"></i> Django</button>
                                <button type="button" class="suggestion-tag" data-tag="React" data-icon="bi bi-browser-chrome"><i class="bi bi-browser-chrome"></i> React</button>
                                <button type="button" class="suggestion-tag" data-tag="JavaScript" data-icon="bi bi-filetype-js"><i class="bi bi-filetype-js"></i> JavaScript</button>
                                <button type="button" class="suggestion-tag" data-tag="PostgreSQL" data-icon="bi bi-database"><i class="bi bi-database"></i> PostgreSQL</button>
                                <button type="button" class="suggestion-tag" data-tag="Redis" data-icon="bi bi-hdd"><i class="bi bi-hdd"></i> Redis</button>
                                <button type="button" class="suggestion-tag" data-tag="Docker" data-icon="bi bi-box"><i class="bi bi-box"></i> Docker</button>
                                <button type="button" class="suggestion-tag" data-tag="AWS" data-icon="bi bi-cloud"><i class="bi bi-cloud"></i> AWS</button>
                            </div>
                        </div>
            
            {{ formset.management_form }}
            
            <div id="tags-container">
                {% for form in formset %}
                            <div class="tag-row-enhanced" data-form-index="{{ forloop.counter0 }}">
                    {{ form.id }}
                    
                                <div class="tag-name-field">
                                    <label>Tag Name</label>
                        {{ form.name }}
                    </div>
                                
                                <div class="tag-icon-field">
                                    <label>
                                        Icon Class
                                        <button type="button" class="icon-picker-btn" onclick="openIconPicker(this)">üé®</button>
                                    </label>
                                    <div class="icon-input-wrapper">
                        {{ form.icon }}
                                        <span class="icon-preview" id="icon-preview-{{ forloop.counter0 }}"></span>
                                    </div>
                    </div>
                    
                    {% if formset.can_delete %}
                                <div class="tag-delete">
                                    <label>&nbsp;</label>
                                    <button type="button" class="btn-delete-tag" onclick="removeTagRow(this)">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                    {{ form.DELETE }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            
                        <button type="button" class="btn-add-tag" onclick="addTagRow()">
                            <i class="bi bi-plus-circle"></i> Add Another Tag
                        </button>

                        <div class="form-actions">
                            <button type="button" class="btn-prev" onclick="prevStep()"><i class="bi bi-arrow-left"></i> Previous</button>
                            <button type="button" class="btn-next" onclick="nextStep()">Next: Review <i class="bi bi-arrow-right"></i></button>
                        </div>
                    </div>

                    <!-- Step 4: Review -->
                    <div class="form-step" data-step="4">
                        <h3 class="step-title">Review & Submit</h3>
                        <div class="review-summary" id="review-summary">
                            <!-- Review content will be populated here -->
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-prev" onclick="prevStep()"><i class="bi bi-arrow-left"></i> Previous</button>
                            <button type="submit" class="btn-submit">
                                <i class="bi bi-check-circle"></i> Save Service
            </button>
                        </div>
                    </div>
        </form>
            </div>
        </div>

        <!-- Live Preview Panel -->
        <div class="preview-panel">
            <div class="glass-card preview-card">
                <div class="preview-header">
                    <h3>Live Preview</h3>
                    <div class="preview-toggle">
                        <button class="toggle-btn active" type="button" onclick="setPreviewSize('desktop', this)">üñ•Ô∏è</button>
                        <button class="toggle-btn" type="button" onclick="setPreviewSize('tablet', this)">üì±</button>
                        <button class="toggle-btn" type="button" onclick="setPreviewSize('mobile', this)">üì±</button>
                    </div>
                </div>
                <div class="preview-content-wrapper preview-desktop" id="preview-content-wrapper">
                    <div class="service-card-preview" id="service-preview">
                        <div class="preview-image">
                            <div class="preview-placeholder">
                                <i class="bi bi-image"></i>
                                <span>Image Preview</span>
                            </div>
                        </div>
                        <div class="preview-card-content">
                            <span class="preview-category-badge" id="preview-category">Category</span>
                            <h3 id="preview-title">Service Title</h3>
                            <p id="preview-description">Service description will appear here...</p>
                            <div class="preview-tags" id="preview-tags">
                                <!-- Tags will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Icon Picker Modal -->
<div id="icon-picker-modal" class="modal">
    <div class="modal-content modal-medium">
        <div class="modal-header">
            <h2>Choose Icon</h2>
            <button class="modal-close" type="button" onclick="closeIconPicker()">
                <i class="bi bi-x"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="icon-search">
                <input type="text" id="icon-search" placeholder="Search icons..." onkeyup="searchIcons(this.value)">
            </div>
            <div class="icon-grid" id="icon-grid">
                <!-- Icons will be populated here -->
            </div>
        </div>
    </div>
</div>

<script>
// Form state
let currentStep = 1;
const totalSteps = 4;
let formMode = 'simple';

// Popular Bootstrap Icons
const popularIcons = [
    'bi-code-square', 'bi-code-slash', 'bi-browser-chrome', 'bi-filetype-js', 
    'bi-database', 'bi-hdd', 'bi-box', 'bi-cloud', 'bi-server', 'bi-router',
    'bi-cpu', 'bi-memory', 'bi-display', 'bi-code', 'bi-terminal', 'bi-git',
    'bi-github', 'bi-filetype-html', 'bi-filetype-css', 'bi-filetype-jsx',
    'bi-filetype-tsx', 'bi-filetype-py', 'bi-filetype-json', 'bi-bootstrap',
    'bi-node-minus', 'bi-arrow-right-circle', 'bi-check-circle', 'bi-star-fill'
];

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    initForm();
    initCharacterCounters();
    initImagePreview();
    initTagSuggestions();
    initIconPicker();
    updatePreview();
});

function initForm() {
    const titleInput = document.querySelector('#id_title');
    const descInput = document.querySelector('#id_description');
    const categorySelect = document.querySelector('#id_category');
    
    if (titleInput) titleInput.addEventListener('input', function() {
        updateCharacterCount('title-count', this.value.length, 200);
        updatePreview();
    });
    
    if (descInput) descInput.addEventListener('input', function() {
        const words = this.value.trim().split(/\s+/).filter(function(w) { return w.length > 0; }).length;
        updateWordCount('desc-count', words);
        updatePreview();
    });
    
    if (categorySelect) categorySelect.addEventListener('change', updatePreview);
}

function initCharacterCounters() {
    const titleInput = document.querySelector('#id_title');
    const descInput = document.querySelector('#id_description');
    
    if (titleInput) {
        updateCharacterCount('title-count', titleInput.value.length, 200);
    }
    
    if (descInput) {
        const words = descInput.value.trim().split(/\s+/).filter(function(w) { return w.length > 0; }).length;
        updateWordCount('desc-count', words);
    }
}

function updateCharacterCount(id, current, max) {
    const counter = document.getElementById(id);
    if (counter) {
        counter.textContent = current;
        counter.style.color = current > max * 0.9 ? '#ff4757' : '#00d2ff';
    }
}

function updateWordCount(id, words) {
    const counter = document.getElementById(id);
    if (counter) counter.textContent = words;
    
    const status = document.getElementById('word-count-status');
    if (status) {
        if (words < 20) {
            status.innerHTML = '<span style="color: #ffa502;">‚ö†Ô∏è Minimum 20 words recommended</span>';
        } else if (words < 50) {
            status.innerHTML = '<span style="color: #f39c12;">‚úì Good length</span>';
        } else {
            status.innerHTML = '<span style="color: #2ecc71;">‚úì Excellent length</span>';
        }
    }
}

function initImagePreview() {
    const imageInput = document.getElementById('id_image');
    const preview = document.getElementById('image-preview');
    
    if (imageInput && preview) {
        imageInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = '<img src="' + e.target.result + '" alt="Preview" style="max-width: 100%; max-height: 300px; border-radius: 8px;">';
                    updatePreview();
                };
                reader.readAsDataURL(file);
                
                const fileLabel = document.getElementById('file-label');
                const fileName = document.getElementById('file-name');
                if (fileLabel) fileLabel.textContent = "Image Selected:";
                if (fileName) fileName.textContent = file.name;
                const uploadZone = document.querySelector('.upload-zone-enhanced');
                if (uploadZone) {
                    uploadZone.style.borderColor = '#00d2ff';
                    uploadZone.style.background = 'rgba(0, 210, 255, 0.05)';
                }
            }
        });
    }
}

function initTagSuggestions() {
    document.querySelectorAll('.suggestion-tag').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const tagName = this.dataset.tag;
            const tagIcon = this.dataset.icon;
            addSuggestedTag(tagName, tagIcon);
        });
    });
}

function addSuggestedTag(name, icon) {
    const container = document.getElementById('tags-container');
    const totalForms = document.getElementById('id_form-TOTAL_FORMS');
    if (!container || !totalForms) return;
    
    const currentCount = parseInt(totalForms.value);
    const newIndex = currentCount;
    totalForms.value = currentCount + 1;
    
    const newRow = document.createElement('div');
    newRow.className = 'tag-row-enhanced';
    newRow.dataset.formIndex = newIndex;
    newRow.innerHTML = 
        '<div class="tag-name-field">' +
            '<label>Tag Name</label>' +
            '<input type="text" name="form-' + newIndex + '-name" value="' + name + '" class="cyber-input" maxlength="50" id="id_form-' + newIndex + '-name">' +
        '</div>' +
        '<div class="tag-icon-field">' +
            '<label>' +
                'Icon Class' +
                '<button type="button" class="icon-picker-btn" onclick="openIconPicker(this)">üé®</button>' +
            '</label>' +
            '<div class="icon-input-wrapper">' +
                '<input type="text" name="form-' + newIndex + '-icon" value="' + icon + '" class="cyber-input icon-input" id="id_form-' + newIndex + '-icon" oninput="updateIconPreview(' + newIndex + ', this.value)">' +
                '<span class="icon-preview" id="icon-preview-' + newIndex + '"><i class="' + icon + '"></i></span>' +
            '</div>' +
        '</div>' +
        '<div class="tag-delete">' +
            '<label>&nbsp;</label>' +
            '<button type="button" class="btn-delete-tag" onclick="removeTagRow(this)">' +
                '<i class="bi bi-trash"></i>' +
            '</button>' +
            '<input type="checkbox" name="form-' + newIndex + '-DELETE" id="id_form-' + newIndex + '-DELETE">' +
        '</div>';
    
    container.appendChild(newRow);
    updatePreview();
}

function removeTagRow(btn) {
    const row = btn.closest('.tag-row-enhanced');
    if (!row) return;
    const deleteCheckbox = row.querySelector('input[name*="-DELETE"]');
    if (deleteCheckbox) {
        deleteCheckbox.checked = true;
        row.style.opacity = '0.5';
        row.style.pointerEvents = 'none';
    } else {
        row.remove();
    }
    updatePreview();
}

function addTagRow() {
    addSuggestedTag('', 'bi bi-check2');
}

function initIconPicker() {
    const iconGrid = document.getElementById('icon-grid');
    if (!iconGrid) return;
    
    popularIcons.forEach(function(icon) {
        const iconBtn = document.createElement('button');
        iconBtn.type = 'button';
        iconBtn.className = 'icon-option';
        iconBtn.innerHTML = '<i class="bi ' + icon + '"></i>';
        iconBtn.title = icon;
        iconBtn.onclick = function() {
            selectIcon('bi ' + icon);
        };
        iconGrid.appendChild(iconBtn);
    });
}

let currentIconInput = null;
function openIconPicker(btn) {
    const row = btn.closest('.tag-row-enhanced');
    if (!row) return;
    const iconInput = row.querySelector('.icon-input');
    if (!iconInput) return;
    currentIconInput = iconInput;
    const modal = document.getElementById('icon-picker-modal');
    if (modal) modal.style.display = 'flex';
}

function closeIconPicker() {
    const modal = document.getElementById('icon-picker-modal');
    if (modal) modal.style.display = 'none';
    currentIconInput = null;
}

function selectIcon(iconClass) {
    if (currentIconInput) {
        currentIconInput.value = iconClass;
        const match = currentIconInput.id.match(/\d+/);
        if (match) {
            const index = match[0];
            updateIconPreview(index, iconClass);
            updatePreview();
        }
    }
    closeIconPicker();
}

function updateIconPreview(index, iconClass) {
    const preview = document.getElementById('icon-preview-' + index);
    if (preview) {
        preview.innerHTML = '<i class="' + iconClass + '"></i>';
    }
}

function searchIcons(query) {
    const icons = document.querySelectorAll('.icon-option');
    icons.forEach(function(icon) {
        const title = icon.title.toLowerCase();
        if (title.includes(query.toLowerCase())) {
            icon.style.display = 'inline-block';
        } else {
            icon.style.display = 'none';
        }
    });
}

// Form Wizard
function nextStep() {
    if (currentStep < totalSteps) {
        currentStep++;
        updateWizardSteps();
    }
}

function prevStep() {
    if (currentStep > 1) {
        currentStep--;
        updateWizardSteps();
    }
}

function updateWizardSteps() {
    document.querySelectorAll('.form-step').forEach(function(step) {
        step.classList.remove('active');
    });
    const activeStep = document.querySelector('.form-step[data-step="' + currentStep + '"]');
    if (activeStep) activeStep.classList.add('active');
    
    document.querySelectorAll('.wizard-step').forEach(function(step, index) {
        step.classList.remove('active', 'completed');
        if (index + 1 < currentStep) {
            step.classList.add('completed');
        } else if (index + 1 === currentStep) {
            step.classList.add('active');
        }
    });
    
    if (currentStep === 4) {
        generateReviewSummary();
    }
    
    updatePreview();
}

function generateReviewSummary() {
    const titleInput = document.querySelector('#id_title');
    const title = titleInput ? titleInput.value : '';
    const category = document.querySelector('#id_category');
    const categoryText = category && category.options[category.selectedIndex] ? category.options[category.selectedIndex].text : '';
    const descInput = document.querySelector('#id_description');
    const description = descInput ? descInput.value : '';
    const imageInput = document.querySelector('#id_image');
    const image = imageInput && imageInput.files[0] ? imageInput.files[0].name : 'No image selected';
    
    const tags = [];
    document.querySelectorAll('.tag-row-enhanced').forEach(function(row) {
        const deleteCheck = row.querySelector('input[name*="-DELETE"]');
        if (!deleteCheck || !deleteCheck.checked) {
            const nameInput = row.querySelector('input[name*="-name"]');
            const iconInput = row.querySelector('input[name*="-icon"]');
            const name = nameInput ? nameInput.value : '';
            const icon = iconInput ? iconInput.value : '';
            if (name) tags.push({name: name, icon: icon});
        }
    });
    
    const summary = document.getElementById('review-summary');
    if (summary) {
        const tagsHtml = tags.map(function(tag) {
            return '<span class="review-tag"><i class="' + (tag.icon || 'bi bi-check2') + '"></i> ' + tag.name + '</span>';
        }).join('');
        
        summary.innerHTML = 
            '<div class="review-item">' +
                '<strong>Category:</strong> ' + categoryText +
            '</div>' +
            '<div class="review-item">' +
                '<strong>Title:</strong> ' + title +
            '</div>' +
            '<div class="review-item">' +
                '<strong>Description:</strong> ' + description.substring(0, 200) + (description.length > 200 ? '...' : '') +
            '</div>' +
            '<div class="review-item">' +
                '<strong>Image:</strong> ' + image +
            '</div>' +
            '<div class="review-item">' +
                '<strong>Tags (' + tags.length + '):</strong>' +
                '<div class="review-tags">' + tagsHtml + '</div>' +
            '</div>';
    }
}

function setFormMode(mode) {
    formMode = mode;
    document.querySelectorAll('.mode-btn').forEach(function(btn) {
        btn.classList.remove('active');
    });
    if (event && event.target) event.target.classList.add('active');
}

function setPreviewSize(size, btn) {
    const wrapper = document.getElementById('preview-content-wrapper');
    if (wrapper) {
        wrapper.className = 'preview-content-wrapper preview-' + size;
    }
    document.querySelectorAll('.toggle-btn').forEach(function(b) {
        b.classList.remove('active');
    });
    if (btn) btn.classList.add('active');
}

function updatePreview() {
    const titleInput = document.querySelector('#id_title');
    const title = titleInput ? titleInput.value : 'Service Title';
    const descInput = document.querySelector('#id_description');
    const description = descInput ? descInput.value : 'Service description will appear here...';
    const category = document.querySelector('#id_category');
    const categoryText = category && category.options[category.selectedIndex] ? category.options[category.selectedIndex].text : 'Category';
    const imageInput = document.querySelector('#id_image');
    
    const previewTitle = document.getElementById('preview-title');
    const previewDesc = document.getElementById('preview-description');
    const previewCat = document.getElementById('preview-category');
    
    if (previewTitle) previewTitle.textContent = title;
    if (previewDesc) previewDesc.textContent = description;
    if (previewCat) previewCat.textContent = categoryText;
    
    if (imageInput && imageInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewImg = document.querySelector('.preview-image');
            if (previewImg) {
                previewImg.innerHTML = '<img src="' + e.target.result + '" alt="Preview" style="width: 100%; height: 200px; object-fit: cover; border-radius: 12px 12px 0 0;">';
            }
        };
        reader.readAsDataURL(imageInput.files[0]);
    }
    
    // Update tags
    const tagsContainer = document.getElementById('preview-tags');
    if (tagsContainer) {
        tagsContainer.innerHTML = '';
        document.querySelectorAll('.tag-row-enhanced').forEach(function(row) {
            const deleteCheck = row.querySelector('input[name*="-DELETE"]');
            if (!deleteCheck || !deleteCheck.checked) {
                const nameInput = row.querySelector('input[name*="-name"]');
                const iconInput = row.querySelector('input[name*="-icon"]');
                const name = nameInput ? nameInput.value : '';
                const icon = iconInput ? iconInput.value : 'bi bi-check2';
                if (name) {
                    const tag = document.createElement('span');
                    tag.className = 'preview-tag';
                    tag.innerHTML = '<i class="' + icon + '"></i> ' + name;
                    tagsContainer.appendChild(tag);
                }
            }
        });
    }
}

// Close modal on outside click
window.onclick = function(event) {
    const modal = document.getElementById('icon-picker-modal');
    if (event.target == modal) {
        closeIconPicker();
    }
    };
</script>

<style>
.service-form-wrapper {
    max-width: 1600px;
    margin: 0 auto;
    padding-bottom: 50px;
}
.form-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: 30px;
}
.form-mode-toggle {
    display: flex;
    gap: 5px;
    background: rgba(255,255,255,0.05);
    padding: 4px;
    border-radius: 8px;
}
.mode-btn {
    padding: 8px 16px;
    background: transparent;
    border: none;
    border-radius: 6px;
    color: rgba(255,255,255,0.6);
    cursor: pointer;
    transition: 0.3s;
}
.mode-btn.active {
    background: rgba(0, 210, 255, 0.2);
    color: #00d2ff;
}

/* Wizard Progress */
.wizard-progress {
    display: flex;
    justify-content: space-between;
    margin-bottom: 40px;
    position: relative;
}
.wizard-progress::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 10%;
    right: 10%;
    height: 2px;
    background: rgba(255,255,255,0.1);
    z-index: 0;
}
.wizard-step {
    flex: 1;
    text-align: center;
    position: relative;
    z-index: 1;
}
.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    border: 2px solid rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 10px;
    color: rgba(255,255,255,0.5);
    font-weight: bold;
    transition: 0.3s;
}
.wizard-step.active .step-number {
    background: rgba(0, 210, 255, 0.2);
    border-color: #00d2ff;
    color: #00d2ff;
}
.wizard-step.completed .step-number {
    background: #2ecc71;
    border-color: #2ecc71;
    color: #fff;
}
.wizard-step span {
    display: block;
    color: rgba(255,255,255,0.6);
    font-size: 12px;
}

/* Form Container */
.form-container {
    display: grid;
    grid-template-columns: 1.2fr 0.8fr;
    gap: 30px;
}
.form-panel, .preview-panel {
    min-width: 0;
}
.form-step {
    display: none;
}
.form-step.active {
    display: block;
}
.step-title {
    color: #fff;
    font-size: 24px;
    margin-bottom: 30px;
    font-family: 'Syne', sans-serif;
}
.form-row {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 20px;
    margin-bottom: 25px;
}
.form-group {
    margin-bottom: 25px;
}
.form-group label {
    display: flex;
    align-items: center;
    justify-content: space-between;
    color: #ccc;
    margin-bottom: 8px;
    font-size: 14px;
}
.required {
    color: #ff4757;
}
.char-counter {
    color: #00d2ff;
    font-size: 12px;
}
.help-icon {
    cursor: help;
    font-size: 16px;
}
.field-hint {
    display: block;
    color: rgba(255,255,255,0.4);
    font-size: 12px;
    margin-top: 5px;
}
.word-count-status {
    margin-top: 8px;
    font-size: 13px;
}

/* Enhanced Upload */
.upload-zone-enhanced {
    border: 2px dashed rgba(255,255,255,0.1);
    padding: 40px;
    text-align: center;
    border-radius: 12px;
    background: rgba(255,255,255,0.01);
    transition: 0.3s;
    cursor: pointer;
}
.upload-zone-enhanced:hover {
    border-color: #00d2ff;
    background: rgba(0, 210, 255, 0.05);
}
.upload-preview img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 8px;
}

/* Tags Section */
.tag-suggestions-panel {
    background: rgba(0, 210, 255, 0.05);
    border: 1px solid rgba(0, 210, 255, 0.2);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 30px;
}
.tag-suggestions-panel h4 {
    color: #fff;
    font-size: 16px;
    margin: 0 0 15px 0;
}
.tag-suggestions {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}
.suggestion-tag {
    padding: 8px 16px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 20px;
    color: rgba(255,255,255,0.8);
    cursor: pointer;
    transition: 0.3s;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
}
.suggestion-tag:hover {
    background: rgba(0, 210, 255, 0.2);
    border-color: #00d2ff;
    color: #00d2ff;
}
.tag-row-enhanced {
    display: grid;
    grid-template-columns: 2fr 2fr auto;
    gap: 15px;
    align-items: end;
    margin-bottom: 20px;
    padding: 20px;
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 12px;
}
.tag-name-field, .tag-icon-field {
    display: flex;
    flex-direction: column;
}
.tag-icon-field label {
    display: flex;
    align-items: center;
    gap: 8px;
}
.icon-picker-btn {
    background: rgba(0, 210, 255, 0.1);
    border: 1px solid rgba(0, 210, 255, 0.3);
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
    font-size: 14px;
}
.icon-input-wrapper {
    position: relative;
}
.icon-preview {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #00d2ff;
    pointer-events: none;
}
.tag-delete {
    display: flex;
    flex-direction: column;
}
.btn-delete-tag {
    padding: 12px;
    background: rgba(231, 76, 60, 0.1);
    border: 1px solid rgba(231, 76, 60, 0.3);
    border-radius: 8px;
    color: #e74c3c;
    cursor: pointer;
    transition: 0.3s;
}
.btn-delete-tag:hover {
    background: rgba(231, 76, 60, 0.2);
}
.btn-add-tag {
    padding: 12px 24px;
    background: rgba(0, 210, 255, 0.1);
    border: 1px solid rgba(0, 210, 255, 0.3);
    border-radius: 8px;
    color: #00d2ff;
    cursor: pointer;
    width: 100%;
    margin-bottom: 30px;
    transition: 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}
.btn-add-tag:hover {
    background: rgba(0, 210, 255, 0.2);
}

/* Review Summary */
.review-summary {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 25px;
}
.review-item {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}
.review-item:last-child {
    border-bottom: none;
}
.review-item strong {
    color: #fff;
    display: block;
    margin-bottom: 8px;
}
.review-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}
.review-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: rgba(0, 210, 255, 0.1);
    border: 1px solid rgba(0, 210, 255, 0.2);
    border-radius: 20px;
    color: #00d2ff;
    font-size: 13px;
}

/* Preview Panel */
.preview-card {
    position: sticky;
    top: 20px;
}
.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}
.preview-header h3 {
    color: #fff;
    margin: 0;
}
.preview-toggle {
    display: flex;
    gap: 5px;
}
.toggle-btn {
    padding: 6px 12px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 6px;
    color: rgba(255,255,255,0.6);
    cursor: pointer;
    transition: 0.3s;
}
.toggle-btn.active {
    background: rgba(0, 210, 255, 0.2);
    border-color: #00d2ff;
    color: #00d2ff;
}
.preview-content-wrapper {
    transition: 0.3s;
}
.preview-desktop {
    max-width: 100%;
}
.preview-tablet {
    max-width: 768px;
    margin: 0 auto;
}
.preview-mobile {
    max-width: 375px;
    margin: 0 auto;
}
.service-card-preview {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 16px;
    overflow: hidden;
}
.preview-image {
    width: 100%;
    height: 200px;
    background: rgba(255,255,255,0.02);
    display: flex;
    align-items: center;
    justify-content: center;
}
.preview-placeholder {
    color: rgba(255,255,255,0.3);
    text-align: center;
}
.preview-placeholder i {
    font-size: 48px;
    display: block;
    margin-bottom: 10px;
}
.preview-card-content {
    padding: 20px;
}
.preview-category-badge {
    display: inline-block;
    padding: 6px 12px;
    background: rgba(0, 210, 255, 0.1);
    border: 1px solid rgba(0, 210, 255, 0.2);
    border-radius: 20px;
    color: #00d2ff;
    font-size: 12px;
    margin-bottom: 15px;
}
.preview-card-content h3 {
    color: #fff;
    font-size: 24px;
    margin: 0 0 15px 0;
    font-family: 'Syne', sans-serif;
}
.preview-card-content p {
    color: rgba(255,255,255,0.7);
    line-height: 1.6;
    margin-bottom: 20px;
}
.preview-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}
.preview-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 20px;
    color: rgba(255,255,255,0.8);
    font-size: 12px;
}

/* Icon Picker Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
    align-items: center;
    justify-content: center;
    padding: 20px;
}
.modal-medium {
    max-width: 600px;
}
.modal-content {
    background: #1a1a2e;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 20px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
}
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}
.modal-header h2 {
    margin: 0;
    color: #fff;
}
.modal-close {
    background: transparent;
    border: none;
    color: rgba(255,255,255,0.7);
    font-size: 24px;
    cursor: pointer;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: 0.3s;
}
.modal-close:hover {
    background: rgba(255,255,255,0.1);
    color: #fff;
}
.modal-body {
    padding: 25px;
}
.icon-search {
    margin-bottom: 20px;
}
.icon-search input {
    width: 100%;
    padding: 12px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    color: #fff;
}
.icon-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
    gap: 10px;
}
.icon-option {
    padding: 15px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    color: rgba(255,255,255,0.7);
    cursor: pointer;
    transition: 0.3s;
    font-size: 24px;
}
.icon-option:hover {
    background: rgba(0, 210, 255, 0.2);
    border-color: #00d2ff;
    color: #00d2ff;
    transform: scale(1.1);
}

/* Form Actions */
.form-actions {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-top: 40px;
    padding-top: 30px;
    border-top: 1px solid rgba(255,255,255,0.1);
}
.btn-prev, .btn-next, .btn-submit {
    padding: 12px 24px;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}
.btn-prev {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    color: rgba(255,255,255,0.7);
}
.btn-prev:hover {
    background: rgba(255,255,255,0.1);
    color: #fff;
}
.btn-next {
    background: rgba(0, 210, 255, 0.2);
    border: 1px solid rgba(0, 210, 255, 0.3);
    color: #00d2ff;
}
.btn-next:hover {
    background: rgba(0, 210, 255, 0.3);
}
.btn-submit {
    background: linear-gradient(90deg, #00d2ff, #7000ff);
    color: #fff;
}
.btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(0, 210, 255, 0.4);
}

/* Common Styles */
.cyber-input, select {
    width: 100%;
    padding: 14px;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    color: white;
    transition: 0.3s;
}
.cyber-input:focus, select:focus {
    outline: none;
    border-color: #00d2ff;
    background: rgba(255,255,255,0.05);
}
select option {
    background: #1a1a2e;
    color: white;
}
.error-display {
    background: rgba(255, 71, 87, 0.1);
    border: 1px solid #ff4757;
    color: #ff4757;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 30px;
}
.fade-in-up {
    animation: fadeInUp 0.5s ease-out;
}
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (max-width: 1200px) {
    .form-container {
        grid-template-columns: 1fr;
    }
    .preview-card {
        position: relative;
        top: 0;
    }
}
@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
    .tag-row-enhanced {
        grid-template-columns: 1fr;
    }
    .wizard-progress {
        font-size: 11px;
    }
    .step-number {
        width: 30px;
        height: 30px;
        font-size: 12px;
    }
}
</style>
{% endblock %}
